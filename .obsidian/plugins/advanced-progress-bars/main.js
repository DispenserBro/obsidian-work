/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ct=Object.defineProperty;var St=Object.getOwnPropertyDescriptor;var vt=Object.getOwnPropertyNames;var Lt=Object.prototype.hasOwnProperty;var Et=(V,E)=>{for(var t in E)Ct(V,t,{get:E[t],enumerable:!0})},It=(V,E,t,e)=>{if(E&&typeof E=="object"||typeof E=="function")for(let i of vt(E))!Lt.call(V,i)&&i!==t&&Ct(V,i,{get:()=>E[i],enumerable:!(e=St(E,i))||e.enumerable});return V};var Mt=V=>It(Ct({},"__esModule",{value:!0}),V);var $t={};Et($t,{default:()=>mt});module.exports=Mt($t);var r=require("obsidian"),d={APB_title:"Progress",APB_total:100,APB_progressBarPercentage:83,APB_widthToggle:!0,APB_width:190,APB_height:8,APB_endcapToggle:!0,APB_marksToggle:!0,APB_autoMarksToggle:!0,APB_manualMarks:3,APB_marksColor:"#000000",APB_marksLightColor:"#ffffff",APB_marksWidth:3,APB_titleToggle:!0,APB_titleColor:"#8fa0ba",APB_titleLightColor:"#44546f",APB_percentageToggle:!0,APB_percentageColor:"#c1d7f9",APB_percentageLightColor:"#6d85ad",APB_fractionToggle:!0,APB_fractionColor:"#8fa0ba",APB_fractionLightColor:"#576a8a",APB_completedToggle:!0,APB_completedColor:"#c1d7f9",APB_completedLightColor:"#44546f",APB_inlineEditToggle:!1,APB_inlineEditStepSize:1,APB_gearColor:"#24647f",APB_gearLightColor:"#796c72",APB_gearHoverColor:"#3db9d1",APB_gearHoverLightColor:"#bb3574",APB_inlinePanelColor:"#5e67ed",APB_inlineButtonColor:"#ffffff",APB_inlineTextColor:"#3f46b0",APB_overageToggle:!1,APB_overageColor:"#38edef",APB_overageLightColor:"#d33411",APB_borderToggle:!0,APB_colorBorder:"#474f62",APB_colorLightBorder:"#ced0d6",APB_backgroundToggle:!0,APB_colorBackground:"#242a35",APB_colorLightBackground:"#f1f2f4",APB_TopMarginToggle:!1,APB_boxShadowToggle:!1,APB_boxShadowTypeToggle:!1,APB_hOffset:2,APB_vOffset:2,APB_blur:5,APB_boxShadowInsetToggle:!1,APB_colorBoxShadow:"#00fff7",APB_colorLightBoxShadow:"#474747",APB_colorBarCompleted:"#576178",APB_colorLightBarCompleted:"#fcfcfd",APB_colorBarBackground:"#3b4252",APB_colorLightBarBackground:"#d9dde2",APB_allowTasksToggle:!1,APB_autoTasksToggle:!1,APB_colorTaskText:"#8fa0ba",APB_colorLightTaskText:"#ffffff",APB_colorTaskBackground:"#3b4252",APB_colorLightTaskBackground:"#44546F",APB_allowSubTasksToggle:!1,APB_colorSubTaskText:"#8fa0ba",APB_colorLightSubTaskText:"#6c7a90",APB_colorSubTaskCompletedText:"#6dd374",APB_colorLightSubTaskCompletedText:"#349a16",APB_progressBarChange:!0,APB_fallbackColor:"#2978ef",APB_pureBlack:"#000000",defaultLightColors:["#278378","#2baab9","#4a32e2","#7c328e","#c11e49"],defaultDarkColors:["#2978ef","#8ec822","#dfaa22","#c84922","#dd4a86"],defaultRainbowColors:["#ff0000","#eeff00","#11ff00","#7300ff","#00e1ff"],defaultTemplate:{name:"Default",gradient:!0,gradientType:!1,colors:["#2978ef","#8ec822","#dfaa22","#c84922","#dd4a86"],isColorPanelVisible:!1,borderColor:"#474f62",backgroundColor:"#242a35",titleTextColor:"#8fa0ba",percentageTextColor:"#c1d7f9",fractionTextColor:"#8fa0ba",completedTextColor:"#c1d7f9",completedColor:"#576178",barBackgroundColor:"#3b4252",colorSubTaskText:"#8fa0ba",colorSubTaskCompletedText:"#6dd374"},templates:[]},mt=class extends r.Plugin{constructor(){super(...arguments);this.isUpdating=!1;this.lastProcessedFile=null;this.lastChangeTime=0;this.MIN_CHANGE_INTERVAL=5e3;this.hasRegisteredEvents=!1;this.lastProcessedFileTime=new Map}async onload(){await this.loadSettings(),this.settingsTab=new Bt(this.app,this),this.addSettingTab(this.settingsTab),this.app.workspace.onLayoutReady(this.initializeProgressBars.bind(this)),this.hasRegisteredEvents||(this.registerEvents(),this.hasRegisteredEvents=!0),this.addCommand({id:"paste-code-block",name:"Paste code block",editorCallback:async(t,e)=>{if(t.focus(),!t){new r.Notice("No active editor found!");return}let i=Math.floor(this.settings.APB_total/100*this.settings.APB_progressBarPercentage),a=`\`\`\`apb
${this.settings.APB_title}: ${i}/${this.settings.APB_total}
\`\`\``,l=t.getCursor();t.replaceRange(a,l);let n=a.split(`
`),c={line:l.line+n.length-1,ch:n[n.length-1].length};setTimeout(()=>{t.setCursor(c),t.refresh()},0)}}),this.addCommand({id:"task-manual-refresh",name:"Task manual refresh",callback:async()=>{if(this.isUpdating||!this.settings.APB_allowTasksToggle||this.settings.APB_autoTasksToggle)return;new r.Notice("Processing Task Update ...",2e3);try{this.isUpdating=!0,await this.updateProgress(),new r.Notice("Task Update Completed",2e3)}catch(e){new r.Notice("Task Update Failed: "+e.message,2e3)}finally{setTimeout(()=>{this.isUpdating=!1},2e3)}if(!this.app.workspace.getActiveFile()){new r.Notice("No active file to refresh",2e3);return}}})}async hasApbWithTag(t,e){try{let i=await e.vault.read(t);return/```apb\b[\s\S]*?#(\w+)[\s\S]*?\n```/g.test(i)}catch(i){return console.error("Error checking hasApbWithTag:",i),!1}}isDashboardPage(t){return t?t.contentEl.querySelector(".dashboard")!==null:!1}async shouldUpdateProgress(t,e){let i=e.workspace.getActiveViewOfType(r.MarkdownView);return await this.hasApbWithTag(t,e)?!0:this.isDashboardPage(i)}registerEvents(){this.settings.APB_allowTasksToggle&&this.settings.APB_autoTasksToggle&&this.registerEvent(this.app.metadataCache.on("changed",yt(async t=>{let e=Date.now(),i=this.lastProcessedFileTime.get(t.path)||0;if(this.isUpdating||e-this.lastChangeTime<this.MIN_CHANGE_INTERVAL||!this.settings.APB_allowTasksToggle)return;let a=this.app.workspace.getActiveFile();if(!a||t.path!==a.path||!await this.shouldUpdateProgress(a,this.app))return;let l=this.app.workspace.getActiveViewOfType(r.MarkdownView);if(!l)return;let n=l.editor,c=n.getCursor();new r.Notice("Processing Task Update ...",2e3);try{this.isUpdating=!0,this.lastChangeTime=e,this.lastProcessedFileTime.set(t.path,e),this.lastProcessedFile=a,await this.updateProgress(),new r.Notice("Task Update Completed",2e3)}catch(u){new r.Notice("Task Update Failed: "+u.message,2e3)}finally{setTimeout(()=>{this.isUpdating=!1},2e3)}n.setCursor(c)},2e3))),this.registerEvent(this.app.workspace.on("file-open",yt(async()=>{var e;if(this.isUpdating||!this.settings.APB_allowTasksToggle)return;let t=this.app.workspace.getActiveFile();if(!(!t||t.path===((e=this.lastProcessedFile)==null?void 0:e.path))&&await this.shouldUpdateProgress(t,this.app))try{this.isUpdating=!0;let i=Date.now();this.lastProcessedFileTime.set(t.path,i),this.lastProcessedFile=t,await this.updateProgress()}finally{setTimeout(()=>{this.isUpdating=!1},2e3)}},2e3)))}async updateProgress(){let t=this.app.workspace.getActiveFile();if(!t)return;let e=new Map,i=await this.app.vault.read(t),a=/(?:^|\n)([ \t]*)(?:-|\*|\d+\.) \[([ x])\] (.+)$/gm,l,n=null;for(;(l=a.exec(i))!==null;){let[c,u,b,m]=l,g=u.replace(/\t/g,"    ").length,A=m.match(/#([\p{L}\p{N}\p{Emoji}_-]+)/u),S=A?A[1].normalize("NFC"):null;g===0?(n=S||null,n&&(e.has(n)||e.set(n,{total:0,completed:0,subTotal:0,subCompleted:0}),e.get(n).total++,b.trim()==="x"&&e.get(n).completed++)):n&&(e.get(n).subTotal++,b.trim()==="x"&&e.get(n).subCompleted++)}for(let[c,{total:u,completed:b,subTotal:m,subCompleted:h}]of e.entries())this.updateProgressBarInNote(c.normalize("NFC"),b,u,h,m)}async findMatchingTasks(t){let e=this.app.workspace.getActiveFile();if(!e)return!1;let i=await this.app.vault.read(e),a=/- \[.\] (.*?)#([\p{L}\p{N}\p{Emoji}_-]+)/gu,l;for(;(l=a.exec(i))!==null;)if(l[2].normalize("NFC")===t.normalize("NFC"))return!0;return!1}async updateTagSpan(t,e){if(e)try{if(this.settings.APB_allowTasksToggle){let i=await this.findMatchingTasks(e);t.id=i?"APB_tag":"APB_notag",t.id=="APB_tag"&&(t.style.color="rgba(255, 255, 255, 0.8)",t.style.background="rgba(0, 0, 0, 0.4)"),t.textContent=i?e:"#"+e+" not found"}else t.id="APB_tasksDisabled",t.textContent="tasks are disabled"}catch(i){console.error("Error searching tasks for tag:",i),t.textContent="#"+e+" not found",t.id="APB_notag"}else console.warn("No tag was found.")}updateProgressBarInNote(t,e,i,a,l){let n=this.app.workspace.getActiveViewOfType(r.MarkdownView);if(!n)return;let c=n.editor.getValue(),u=/```apb\n([\s\S]+?)\n```/g,b=c.replace(u,(m,h)=>"```apb\n"+h.trim().split(`
`).map(S=>{let C=S.match(/^(.+?)\s*(?:#([\p{L}\p{N}\p{Emoji}_-]+))?(?:\s*~(\d+)\/(\d+))?\s*:\s*(\d+)\/(\d+)(?:\{([^}]+)\})?(?:\s*(?:\[.*?\])?)?$/u);if(C){let w=C[1].trim()||"",T=C[2]||"",W=C[3]?parseInt(C[3],10):null,P=C[4]?parseInt(C[4],10):null,$=C[7]||"";if(t.normalize("NFC")===T.normalize("NFC")){let F=$?`{${$}}`:"";return`${w}#${t}~${a}/${l}: ${e}/${i}${F}`}}return S}).join(`
`)+"\n```");this.isUpdating=!0;try{if(c!==b){let m=Date.now();n.editor.setValue(b)}}finally{setTimeout(()=>{this.isUpdating=!1},2e3)}}initializeProgressBars(){this.registerMarkdownCodeBlockProcessor("apb",(t,e,i)=>{this.renderProgressBar(t,e)})}getTemplateIndexByName(t){return this.settings.templates.findIndex(e=>e.name===t)}applyContainerStyle(t,e,i,a,l){t.style[e]=i!==l?e==="border"?`1px solid ${i}`:i:a}renderProgressBar(t,e){{let i=t.trim().split(`
`);e.empty(),i.forEach((a,l)=>{let n=a.match(/^(.+?)(?:#([\p{L}\p{N}\p{Emoji}_-]+))?(?:~(\d+)\/(\d+))?(?::\s*(\d+)\/(\d+))(?:\{([^}]+)\})?(?:\s.*)?$/u);if(!n){ut(e,"APB_Error: Invalid block format");return}let c=n[1]||"",u=n[2]||"",b=n[3]?parseInt(n[3],10):null,m=n[4]?parseInt(n[4],10):null,h=n[5]?parseInt(n[5],10):0,g=n[6]?parseInt(n[6],10):0,A=n[7]||"";if(!this.settings.APB_overageToggle&&h>g&&g!==0){ut(e,"APB_Error: Value is too large");return}if(isNaN(h)||isNaN(g)||g===0){ut(e,"APB_Error: Invalid number");return}let S=h/g*100,C=Math.round(S-100),w=Math.min(Math.max(Math.round(S),0),100),T=document.createElement("div");T.addClass("progressBar-container"),l===0&&this.settings.APB_TopMarginToggle?T.style.marginTop="25px":T.style.marginTop="7px";let W=this.getTemplateIndexByName(A),P=!A.trim()||W===-1?this.settings.defaultTemplate:this.settings.templates[W];this.applyContainerStyle(T,"border",P.borderColor,"0px",this.settings.APB_pureBlack),this.applyContainerStyle(T,"background",P.backgroundColor,"transparent",this.settings.APB_pureBlack);let $=this.settings.APB_boxShadowInsetToggle?" inset ":"";this.settings.APB_boxShadowToggle?(this.settings.APB_boxShadowTypeToggle?T.style.boxShadow=this.settings.APB_hOffset+"px "+this.settings.APB_vOffset+"px "+this.settings.APB_blur+"px "+this.settings.APB_colorBoxShadow+$:T.style.boxShadow="0px 0px "+this.settings.APB_blur+"px "+this.settings.APB_colorBoxShadow+$,e.style.padding=this.settings.APB_blur+"px"):(T.style.boxShadow="",e.style.padding="0px");let F=document.createElement("div");F.addClass("progressBar-text-container");let k=document.createElement("div");k.addClass("progressBar-background"),w!==100&&(k.style.overflow="hidden");let N=document.createElement("div");if(N.addClass("progressBar-title"),P.titleTextColor!==this.settings.APB_pureBlack){let B=c.split("~")[1],x=null,G=null;if(B){let I=B.match(/(\d+)\/(\d+)/);I&&(x=parseInt(I[1],10),G=parseInt(I[2],10))}if(u&&this.app.workspace.getActiveViewOfType(r.MarkdownView)){let L=N.createEl("span",{text:u});this.updateTagSpan(L,u)}N.createEl("span",{text:c}),N.style.color=P.titleTextColor}let v=document.createElement("div");this.settings.APB_allowTasksToggle&&this.settings.APB_allowSubTasksToggle&&m!==null&&m!==0&&(b==m?(v.addClass("progressBar-subtask-completed"),P.colorSubTaskCompletedText&&P.colorSubTaskCompletedText!==this.settings.APB_pureBlack?(v.style.color=P.colorSubTaskCompletedText,v.createEl("span",{text:"Sub Tasks - "+b+"/"+m+" completed"})):P.colorSubTaskCompletedText=this.settings.APB_pureBlack):(v.addClass("progressBar-subtask"),P.colorSubTaskText&&P.colorSubTaskText!==this.settings.APB_pureBlack?(v.style.color=P.colorSubTaskText,v.createEl("span",{text:"Sub Tasks - "+b+"/"+m})):P.colorSubTaskText=this.settings.APB_pureBlack));let j=document.createElement("div");j.addClass("progressBar-percentage"),P.percentageTextColor!==this.settings.APB_pureBlack&&(this.settings.APB_overageToggle&&C>0?(j.createEl("span",{text:C+100+"%"}),j.style.color=this.settings.APB_overageColor):(j.createEl("span",{text:w+"%"}),j.style.color=P.percentageTextColor));let q=document.createElement("div");q.addClass("progressBar-value"),P.fractionTextColor!==this.settings.APB_pureBlack&&(q.createEl("span",{text:"("+h+"/"+g+")"}),q.style.color=P.fractionTextColor);let X=document.createElement("div");X.addClass("progressBar-completed"),P.completedTextColor!==this.settings.APB_pureBlack&&X.createEl("span",{text:""});let D=null,ot=!1,Q=!1;if(A&&A.trim()!==""){Q=!0;let _=this.settings.templates.find(B=>B.name.toLowerCase()===A.toLowerCase());if(ot=!!_,D=ot?_:this.settings.defaultTemplate,!ot){ut(e,`APB_Error: Template "${A}" not found`);return}}else D=this.settings.defaultTemplate;let nt=D?D.gradient:!1,dt=D?D.gradientType:!1,et=D&&D.colors?Array.isArray(D.colors)?D.colors:[D.colors]:["#ff0000","#00ff00"],J=et.filter(_=>_&&_!=="#000000").slice(0,5),Y=J.length,R=document.createElement("div");R.className="progressBar-filled",R.style.position="relative",R.style.width=`${w}%`,R.style.height=`${this.settings.APB_height}px`,k.appendChild(R);let H=document.createElement("div");H.addClass("progressBar");let st=this.settings.APB_width,bt=parseInt(st.toString(),10);this.settings.APB_widthToggle?(T.style.width="100%",k.style.width="100%",H.style.width=`${100-w}%`):(k.style.width=`${st}px`,T.style.width=`${bt+10}px`,H.style.width=`${100-w}%`),H.style.background=P.barBackgroundColor,H.style.height=`${this.settings.APB_height}px`,this.settingsTab.setEndCaps(k,H,this.settings.APB_endcapToggle,w),w!==100&&k.appendChild(H);let at=document.createElement("div");at.addClass("marks");var pt;if(this.settings.APB_autoMarksToggle?pt=Y:pt=this.settings.APB_manualMarks+1,w!==100){if(this.settings.APB_marksToggle)for(let _=1;_<=pt-1;_++){let B=document.createElement("div");B.addClass("mark"),B.style.left=`${_*(100/pt)}%`,at.appendChild(B);let x=window.devicePixelRatio||1,G=this.settings.APB_marksWidth/x,I=this.settingsTab.hexToRgba(this.settings.APB_marksColor,.5);B.style.borderLeft=G+"px solid "+I}k.appendChild(at)}if(R.appendChild(X),this.settings.APB_endcapToggle&&w>0&&w<100){let _=window.devicePixelRatio||1,B=document.createElementNS("http://www.w3.org/2000/svg","svg");B.setAttribute("class","progressBar-mask"),B.setAttribute("width",`${this.settings.APB_height/2}`),B.setAttribute("height",`${this.settings.APB_height}`),B.setAttribute("viewBox",`0 0 ${this.settings.APB_height/2} ${this.settings.APB_height}`),B.style.position="absolute",B.style.top="0",B.style.right=`-${1/_}px`,B.style.width=`${(this.settings.APB_height+.5)/2}px`,B.style.height=`${this.settings.APB_height}px`;let x=`round-end-mask-${Math.random().toString(36).substring(2,9)}`;B.innerHTML=`
						<defs>
							<mask id="${x}">
							<rect x="0" y="-1" width="${(this.settings.APB_height+10.5)/2}" height="${this.settings.APB_height+3}" fill="white"/>
							<circle cx="0" cy="${this.settings.APB_height/2}" r="${this.settings.APB_height/2}" fill="black"/>
							</mask>
						</defs>
						<rect x="0" y="-1" width="${(this.settings.APB_height+10.5)/2}" height="${this.settings.APB_height+3}" fill="${P.barBackgroundColor}" mask="url(#${x})"/>
						`,R.appendChild(B)}if(k.appendChild(H),w!==100&&(k.style.overflow="hidden"),w<100)if(nt)if(J.length===0&&J.push(this.settings.APB_fallbackColor),J.length===1){let _=J[0]||this.settings.APB_fallbackColor;k.style.backgroundColor=_,R.style.backgroundImage=""}else{let _=J.join(", ");dt?(R.style.backgroundImage=`linear-gradient(to right, ${_})`,k.style.backgroundImage=""):(R.style.backgroundImage="",k.style.backgroundImage=`linear-gradient(to right, ${_})`)}else{let _=100/Y,B=Math.min(Math.floor(w/_),Y-1);R.style.backgroundColor=Y>0?J[B]:this.settings.APB_fallbackColor,k.style.backgroundImage=""}else H.style.backgroundColor=P.completedColor,P.completedTextColor!==this.settings.APB_pureBlack&&(X.addClass("progressBar-completed"),X.style.color=P.completedTextColor,X.textContent="COMPLETED"),R.style.backgroundImage="",k.style.backgroundColor=w===100?P.completedColor:et[0];if(k.style.backgroundSize="100% 100%",k.style.backgroundRepeat="no-repeat",this.settings.APB_progressBarChange=!0,T.appendChild(F),P.titleTextColor!==this.settings.APB_pureBlack&&F.appendChild(N),P.percentageTextColor!==this.settings.APB_pureBlack&&F.appendChild(j),P.fractionTextColor!==this.settings.APB_pureBlack&&F.appendChild(q),T.appendChild(k),T.appendChild(v),!u&&this.settings.APB_inlineEditToggle){l==0?T.style.marginTop="25px":T.style.marginTop="7px";let _,B;T.style.background!=="transparent"?(_=wt(T.style.background,.3),B=wt(T.style.background,.5)):(_="#999999",B="#666666");let x=document.createElement("button");x.className="progressBar-settings-button",x.innerHTML=`
					<svg class="settings-icon" width="16" height="16" viewBox="0 0 24 24" fill="`+_+`" xmlns="http://www.w3.org/2000/svg">
						<path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97s-.03-.66-.07-.97l2.03-1.63a.5.5 0 0 0 .11-.64l-2-3.46a.5.5 0 0 0-.61-.22l-2.39.96c-.51-.38-1.06-.7-1.65-.97l-.36-2.55a.5.5 0 0 0-.5-.41h-4a.5.5 0 0 0-.5.41l-.36 2.55c-.59.27-1.14.59-1.65.97l-2.39-.96a.5.5 0 0 0-.61.22l-2 3.46a.5.5 0 0 0 .11.64l2.03 1.63c-.04.31-.07.65-.07.97s.03.66.07.97l-2.03 1.63a.5.5 0 0 0-.11.64l2 3.46a.5.5 0 0 0 .61.22l2.39-.96c.51.38 1.06.7 1.65.97l.36 2.55a.5.5 0 0 0 .5.41h4a.5.5 0 0 0 .5-.41l.36-2.55c.59-.27 1.14-.59 1.65-.97l2.39.96a.5.5 0 0 0 .61-.22l2-3.46a.5.5 0 0 0-.11-.64l-2.03-1.63z"/>
					</svg>
					`,x.style.backgroundColor="transparent",x.style.border="0px solid transparent",x.style.display="inline-flex",x.style.alignItems="center",x.style.justifyContent="center",x.style.boxShadow="none";let G=document.createElement("style");G.setAttribute("data-plugin","SvgIconPlugin"),G.textContent=`
						.progressBar-settings-button:hover .settings-icon {
							fill: ${B};
						}
					`,document.head.appendChild(G);let I=document.createElement("div");I.className="progressBar-settings-panel",I.style.backgroundColor=this.settings.APB_inlinePanelColor;let L=document.createElement("input");L.type="number",L.value=h.toString(),L.style.width="60px",L.style.marginRight="5px",L.style.border="none",L.style.boxShadow="none";let O=document.createElement("div");O.style.display="flex",O.style.flexWrap="wrap",O.style.gap="5px",O.style.margin="3px";let K=document.createElement("button");K.textContent="+"+this.settings.APB_inlineEditStepSize,K.style.backgroundColor=this.settings.APB_inlineButtonColor,K.style.color=this.settings.APB_inlineTextColor;let lt=document.createElement("button");lt.textContent="\u2212"+this.settings.APB_inlineEditStepSize,lt.style.backgroundColor=this.settings.APB_inlineButtonColor,lt.style.color=this.settings.APB_inlineTextColor;let tt=document.createElement("button");tt.textContent="Apply",tt.style.backgroundColor=this.settings.APB_inlineButtonColor,tt.style.color=this.settings.APB_inlineTextColor;let rt=document.createElement("button");rt.textContent="Cancel",rt.style.backgroundColor=this.settings.APB_inlineButtonColor,rt.style.color=this.settings.APB_inlineTextColor,K.addEventListener("click",z=>{z.stopPropagation();let y=parseInt(L.value);if(isNaN(y)){new r.Notice("Invalid progress value",2e3);return}let U=y+this.settings.APB_inlineEditStepSize;this.settings.APB_overageToggle||(U=Math.min(Math.max(U,0),g)),L.value=U.toString()}),lt.addEventListener("click",z=>{z.stopPropagation();let y=parseInt(L.value);if(isNaN(y)){new r.Notice("Invalid progress value",2e3);return}let U=this.settings.APB_inlineEditStepSize||1,gt=y-U;gt=Math.max(gt,0),L.value=gt.toString()}),tt.addEventListener("click",async z=>{if(z.stopPropagation(),!this.settings.APB_allowTasksToggle){new r.Notice("Task updates are disabled",2e3);return}let y=this.app.workspace.getActiveFile();if(!y){new r.Notice("No active file",2e3);return}let U=parseInt(L.value);if(isNaN(U)){new r.Notice("Invalid number",2e3);return}await this.updateProgressValue(y,l,U,g,a),I.style.display="none"}),rt.addEventListener("click",z=>{z.stopPropagation(),I.style.display="none"});let ht=z=>{let y=z.target;!I.contains(y)&&!x.contains(y)&&(I.style.display="none")};x.addEventListener("click",z=>{z.stopPropagation(),z.preventDefault();let y=I.style.display==="flex";I.style.display=y?"none":"flex",y?document.removeEventListener("click",ht,{capture:!0}):(L.value=h.toString(),L.focus(),document.addEventListener("click",ht,{capture:!0}))}),O.appendChild(L),O.appendChild(lt),O.appendChild(K),O.appendChild(tt),O.appendChild(rt),I.appendChild(O),F.appendChild(x),F.appendChild(I)}e.appendChild(T);let ct=this.app.workspace.getActiveViewOfType(r.MarkdownView);if(ct){let B=ct.contentEl.querySelector(".dashboard")!==null,x=e.closest("li");x&&B&&!x.classList.contains("apb-list-item")&&x.classList.add("apb-list-item")}})}}async updateProgressValue(t,e,i,a,l){var h;let n=i;this.settings.APB_overageToggle?n=Math.max(i,0):n=Math.min(Math.max(i,0),a);let u=(await this.app.vault.read(t)).split(`
`),b=-1;for(let g=0;g<u.length;g++)if(u[g].trim()===l.trim()){b=g;break}if(b===-1){console.error("Could not find row matching originalRow:",l),new r.Notice("Failed to update: Progress bar row not found",2e3);return}let m=u[b];if(e<u.length){let g=m.match(/^(.+?)(?:#([\p{L}\p{N}\p{Emoji}_-]+))?(?:~(\d+)\/(\d+))?(?::\s*(\d+)\/(\d+))(?:\{([^}]+)\})?(?:\s.*)?$/u);if(g){let A=g[1]||"",S=g[2]?`#${g[2]}`:"",C=g[3]||"",w=g[4]||"",T=C&&w?`~${C}/${w}`:"",W=g[7]?`{${g[7]}}`:"",P=((h=m.match(/(?:\s.*)?$/))==null?void 0:h[0])||"",$=`${A}${S}${T}: ${n}/${a}${W}`;u[b]=$;let F=u.join(`
`);await this.app.vault.modify(t,F);try{await this.app.vault.modify(t,F);let k=await this.app.vault.read(t)}catch(k){console.error("File write failed:",k),new r.Notice("Failed to write to file: "+k.message,2e3);return}new r.Notice("APB Data Update ...",2e3);try{this.isUpdating=!0,await this.updateProgress(),new r.Notice("APB Data Update Completed",2e3)}catch(k){new r.Notice("APB Data Update Failed: "+k.message,2e3)}finally{setTimeout(()=>{this.isUpdating=!1},2e3)}}else console.error("Regex failed to match row:",m),new r.Notice("Failed to update: Invalid row format",2e3)}}async loadSettings(){this.settings=Object.assign({},d,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async onunload(){let t=document.querySelector("#copypastebutton");t&&t.removeEventListener("click",this.copyButtonListener)}},Bt=class extends r.PluginSettingTab{constructor(t,e){super(t,e);this.colorPickerContainers={};this.colorPickers={};this.plugin=e,this.display()}display(){this.containerEl.empty(),this.createSettingsUI(this.containerEl)}createSettingsUI(t){var U,gt,Pt,Tt,At,kt;let e,i,a=t.createEl("p",{text:"If you find value in this plugin and would like to support us, please consider using our "});var l="https://ko-fi.com/cactuzhead";a.createEl("a",{href:l,text:"ko-fi",cls:"custom-link"});let n=t.createEl("div");n.addClass("custom-container"),n.appendChild(a);let c=n.createEl("a");c.target="_blank";var u=new DOMParser,b='<svg width="80" height="22" viewBox="0 0 80 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g transform="matrix(0.108521,0,0,0.108521,-0.00522351,0.26727)"><clipPath id="_clip1"><rect x="-0.006" y="0.3" width="737.184" height="200.806"/></clipPath><g clip-path="url(#_clip1)"><defs><mask id="Mask"><g transform="matrix(9.2148,-0,-0,9.2148,0.0481336,-2.46284)"><image id="_Image2" width="80px" height="22px" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAWCAAAAABye0QAAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAMUlEQVQ4jWNcKcxATfCE8akkVQ28xcLISFUDGZmoahwDA8OogaMGjho4auCogUPFQAC80QOoo1cvEAAAAABJRU5ErkJggg=="/></g></mask></defs><g mask="url(#Mask)"><path d="M345.948,199.597C333.351,199.597 320.101,192.881 308.601,181.463C308.164,182.224 307.701,182.96 307.225,183.671C302.379,190.933 293.043,199.597 276.038,199.597C264.399,199.597 248.713,195.081 240.055,173.567C234.251,159.149 231.549,137.051 231.549,104.018C231.549,75.038 234.892,51.931 241.482,35.345C245.294,25.742 250.299,18.143 256.35,12.758C263.454,6.441 272.112,3.098 281.378,3.098C293.607,3.098 304.098,8.616 310.917,18.638C311.957,20.173 312.908,21.803 313.764,23.528C327.326,9.942 341.121,3.092 354.999,3.092C373.279,3.092 385.084,15.72 385.084,35.269C385.084,46.305 379.97,59.117 369.879,73.338C364.063,81.533 356.826,89.924 348.593,98.024C363.72,120.871 377.649,149.261 377.649,167.179C377.649,175.844 374.402,183.963 368.496,190.039C362.515,196.198 354.504,199.591 345.935,199.591L345.948,199.597Z" style="fill:white;fill-rule:nonzero;"/><path d="M369.867,35.269C369.867,25.977 366.15,18.315 355.006,18.315C342.929,18.315 325.049,26.91 303.217,62.207C303.914,58.027 304.143,54.076 304.143,50.365C304.143,31.318 296.246,18.315 281.385,18.315C258.855,18.315 246.779,50.131 246.779,104.013C246.779,167.187 256.762,184.369 276.044,184.369C292.301,184.369 300.66,173.218 301.593,144.657C313.207,169.971 332.019,184.369 345.954,184.369C355.012,184.369 362.446,176.935 362.446,167.18C362.446,152.782 347.813,121.893 328.537,95.881C350.604,76.605 369.879,51.754 369.879,35.263L369.867,35.269Z" style="fill:white;fill-rule:nonzero;"/><path d="M695.015,83.124C672.151,83.124 653.549,64.241 653.549,41.027C653.549,29.921 657.78,19.633 665.451,12.059C673.142,4.473 683.639,0.3 695.015,0.3C706.396,0.3 717.069,4.442 724.879,11.958C732.811,19.595 737.177,29.997 737.177,41.255C737.177,64.343 718.264,83.124 695.015,83.124Z" style="fill:white;fill-rule:nonzero;"/><path d="M695.016,67.902C709.879,67.902 721.954,55.832 721.954,41.256C721.954,26.68 710.578,15.523 695.016,15.523C679.458,15.523 668.769,26.68 668.769,41.028C668.769,55.375 680.384,67.902 695.016,67.902Z" style="fill:white;fill-rule:nonzero;"/><path d="M691.999,200.862C677.025,200.862 664.762,193.416 657.486,179.906C651.558,168.888 648.67,153.627 648.67,133.261C648.67,112.894 651.569,97.659 657.532,86.641C664.935,72.96 677.505,65.425 692.924,65.425C708.344,65.425 719.501,72.078 726.574,84.662C732.54,95.28 735.32,110.141 735.32,131.434C735.32,152.727 732.498,168.349 726.689,179.493C719.509,193.27 707.184,200.862 691.999,200.862Z" style="fill:white;fill-rule:nonzero;"/><path d="M692.924,80.654C672.951,80.654 663.894,98.42 663.894,133.261C663.894,168.102 673.185,185.64 691.999,185.64C710.812,185.64 720.104,168.559 720.104,131.441C720.104,94.323 711.047,80.654 692.932,80.654L692.924,80.654Z" style="fill:white;fill-rule:nonzero;"/><path d="M597.708,200.865C582.396,200.865 571.631,193.92 565.725,180.226C561.94,171.447 559.966,159.681 559.275,140.983C554.353,138.896 550.275,136.194 546.95,132.826C540.627,126.42 537.424,118.06 537.424,107.981C537.424,97.281 540.496,88.515 546.551,81.931C549.838,78.361 553.923,75.5 558.887,73.312C559.77,51.791 566.578,33.701 578.711,20.787C591.124,7.575 608.831,0.3 628.597,0.3C642.753,0.3 655.044,4.105 664.139,11.298C673.8,18.941 679.121,29.743 679.121,41.712C679.121,57.582 670.782,70.191 657.317,76.623C665.706,82.084 672.152,91.046 672.152,105.932C672.152,119.328 667.514,129.61 658.369,136.505C653.047,140.513 646.405,143.272 637.616,145.036C636.468,161.248 634.019,172.57 629.96,180.885C623.567,193.958 612.418,200.865 597.708,200.865Z" style="fill:white;fill-rule:nonzero;"/><path d="M663.892,41.713C663.892,27.365 651.118,15.523 628.588,15.523C597.934,15.523 574.01,36.473 574.01,78.152L574.01,84.526C559.147,87.489 552.639,94.32 552.639,107.982C552.639,119.824 559.143,126.655 574.236,129.617C574.701,173.801 580.51,185.643 597.692,185.643C614.873,185.643 621.846,173.116 623.006,131.672C647.624,129.624 656.916,122.792 656.916,105.94C656.916,90.907 647.624,84.761 623.006,82.941C622.771,74.74 622.771,68.822 622.545,64.496C626.261,65.409 631.138,66.088 635.319,66.088C652.969,66.088 663.885,56.295 663.885,41.719L663.892,41.713Z" style="fill:white;fill-rule:nonzero;"/><path d="M418.638,199.597C398.105,199.597 379.287,190.927 365.65,175.184C352.565,160.082 345.353,139.588 345.353,117.49C345.353,95.392 352.539,75.704 365.586,61.477C378.957,46.895 397.801,38.859 418.638,38.859C439.475,38.859 458.354,46.781 471.65,61.166C484.912,75.52 491.923,94.992 491.923,117.484C491.923,139.975 484.716,160.075 471.623,175.178C457.982,190.92 439.164,199.591 418.638,199.591L418.638,199.597Z" style="fill:white;fill-rule:nonzero;"/><path d="M418.639,54.082C384.494,54.082 360.576,80.094 360.576,117.484C360.576,154.875 385.427,184.369 418.639,184.369C451.85,184.369 476.7,155.573 476.7,117.484C476.7,79.396 452.78,54.082 418.639,54.082ZM416.089,131.654C408.89,131.654 403.55,125.153 403.55,117.256C403.55,110.057 408.89,104.247 416.089,104.247C423.288,104.247 428.399,110.05 428.399,117.256C428.399,125.153 423.058,131.654 416.089,131.654Z" style="fill:white;fill-rule:nonzero;"/><path d="M511.712,143.855C498.455,143.855 488.921,141.363 481.703,136.009C472.868,129.451 468.384,119.309 468.384,105.875C468.384,90.138 475.456,81.461 481.388,76.952C489.094,71.091 499.395,68.357 513.797,68.357C528.203,68.357 538.846,70.894 546.621,76.337C553.106,80.878 560.839,89.809 560.839,106.573C560.839,123.337 552.63,132.337 545.742,136.669C537.844,141.642 527.347,143.855 511.705,143.855L511.712,143.855Z" style="fill:white;fill-rule:nonzero;"/><path d="M513.797,83.581C492.2,83.581 483.607,90.78 483.607,105.876C483.607,123.293 493.363,128.634 511.712,128.634C535.632,128.634 545.619,123.059 545.619,106.568C545.619,90.076 535.636,83.575 513.805,83.575L513.797,83.581Z" style="fill:white;fill-rule:nonzero;"/><path d="M96.246,197.935C61.202,197.935 32.697,182.263 15.991,153.803C1.199,128.856 -0.006,101.836 -0.006,71.644C-0.006,53.745 5.379,38.161 15.559,26.573C24.915,15.929 38.171,9.035 52.893,7.157C70.367,4.944 92.091,4.76 114.678,4.76C151.434,4.76 161.817,5.21 176.279,6.656C195.517,8.565 211.704,15.746 223.082,27.423C234.639,39.283 240.747,55.121 240.747,73.243L240.747,76.884C240.747,107.805 220.076,133.683 191.267,140.717C189.117,145.792 186.453,150.84 183.301,155.813L183.218,155.94C173.07,171.626 149.214,197.942 103.521,197.942L96.24,197.942L96.246,197.935Z" style="fill:white;fill-rule:nonzero;"/><path d="M174.77,21.798C161.114,20.434 151.555,19.977 114.684,19.977C91.013,19.977 70.983,20.206 54.828,22.254C33.434,24.988 15.223,41.372 15.223,71.646C15.223,101.92 16.815,125.362 29.108,146.072C42.992,169.743 66.207,182.714 96.253,182.714L103.534,182.714C140.404,182.714 160.435,163.14 170.45,147.664C174.776,140.833 177.96,134.008 180.009,127.177C206.185,124.9 225.531,103.277 225.531,76.878L225.531,73.238C225.531,44.79 206.871,24.988 174.776,21.798L174.77,21.798Z" style="fill:white;fill-rule:nonzero;"/><rect x="648.67" y="58.671" width="34.387" height="24.363" style="fill:white;fill-rule:nonzero;"/><path d="M668.769,41.028C668.769,55.832 680.384,67.902 695.016,67.902C709.648,67.902 721.954,55.832 721.954,41.256C721.954,26.68 710.578,15.523 695.016,15.523C679.458,15.523 668.769,26.68 668.769,41.028ZM663.893,133.264C663.893,168.562 673.185,185.643 691.998,185.643C710.812,185.643 720.103,168.562 720.103,131.444C720.103,94.326 711.046,80.657 692.931,80.657C672.958,80.657 663.901,98.423 663.901,133.264M552.647,107.982C552.647,119.824 559.148,126.655 574.245,129.617C574.705,173.801 580.518,185.643 597.7,185.643C614.882,185.643 621.854,173.116 623.014,131.672C647.629,129.624 656.921,122.792 656.921,105.94C656.921,90.907 647.629,84.761 623.014,82.941C622.78,74.74 622.78,68.822 622.549,64.496C626.266,65.409 631.146,66.088 635.323,66.088C652.977,66.088 663.893,56.295 663.893,41.719C663.893,27.143 651.119,15.53 628.589,15.53C597.934,15.53 574.01,36.48 574.01,78.158L574.01,84.533C559.148,87.495 552.64,94.326 552.64,107.988M483.606,105.876C483.606,123.293 493.362,128.634 511.711,128.634C535.631,128.634 545.617,123.059 545.617,106.567C545.617,90.076 535.631,83.575 513.803,83.575C491.98,83.575 483.613,90.774 483.613,105.87M403.541,117.255C403.541,110.056 408.881,104.246 416.08,104.246C423.279,104.246 428.394,110.05 428.394,117.255C428.394,125.152 423.053,131.653 416.08,131.653C409.108,131.653 403.541,125.152 403.541,117.255ZM360.575,117.49C360.575,155.578 385.426,184.374 418.637,184.374C451.849,184.374 476.698,155.578 476.698,117.49C476.698,79.401 452.778,54.087 418.637,54.087C384.493,54.087 360.575,80.099 360.575,117.49ZM281.379,18.314C258.849,18.314 246.773,50.129 246.773,104.011C246.773,167.185 256.762,184.368 276.038,184.368C292.295,184.368 300.655,173.218 301.587,144.656C313.201,169.97 332.013,184.368 345.948,184.368C355.006,184.368 362.439,176.934 362.439,167.179C362.439,152.781 347.807,121.892 328.531,95.88C350.598,76.604 369.873,51.753 369.873,35.262C369.873,25.97 366.156,18.308 355.012,18.308C342.936,18.308 325.055,26.902 303.223,62.2C303.921,58.02 304.149,54.068 304.149,50.358C304.149,31.31 296.253,18.308 281.391,18.308" style="fill:rgb(32,32,32);fill-rule:nonzero;"/><path d="M15.218,71.646C15.218,41.372 33.428,24.988 54.822,22.254C70.984,20.206 91.014,19.977 114.679,19.977C151.55,19.977 161.108,20.434 174.764,21.798C206.859,24.982 225.519,44.784 225.519,73.238L225.519,76.878C225.519,103.283 206.174,124.906 179.997,127.177C177.948,134.008 174.764,140.833 170.439,147.664C160.423,163.14 140.393,182.714 103.522,182.714L96.241,182.714C66.195,182.714 42.98,169.743 29.096,146.072C16.804,125.362 15.212,102.37 15.212,71.646" style="fill:rgb(32,32,32);fill-rule:nonzero;"/><path d="M32.285,71.872C32.285,101.233 34.105,120.121 43.664,137.647C54.586,157.905 74.388,165.644 96.924,165.644L103.977,165.644C133.567,165.644 147.907,151.303 155.874,138.788C159.743,132.414 163.156,125.361 164.976,116.481L166.34,110.791L174.535,110.791C192.745,110.791 208.449,96 208.449,77.105L208.449,73.692C208.449,52.527 195.25,41.369 172.258,38.642C159.287,37.507 151.548,37.05 114.672,37.05C89.865,37.05 72.112,37.278 58.684,39.327C39.795,42.061 32.279,52.755 32.279,71.872" style="fill:white;fill-rule:nonzero;"/><path d="M166.348,87.575C166.348,90.308 168.397,92.357 172.037,92.357C183.645,92.357 190.019,85.754 190.019,74.832C190.019,63.91 183.645,57.079 172.037,57.079C168.397,57.079 166.348,59.128 166.348,61.861L166.348,87.581L166.348,87.575Z" style="fill:rgb(32,32,32);fill-rule:nonzero;"/><path d="M54.593,86.205C54.593,99.633 62.103,111.24 71.662,120.348C78.036,126.495 88.051,132.869 94.876,136.966C96.925,138.102 98.974,138.787 101.251,138.787C103.984,138.787 106.255,138.102 108.082,136.966C114.913,132.869 124.922,126.495 131.068,120.348C140.855,111.246 148.365,99.639 148.365,86.205C148.365,71.636 137.443,58.665 121.738,58.665C112.408,58.665 106.033,63.447 101.251,70.044C96.925,63.441 90.329,58.665 80.992,58.665C65.059,58.665 54.587,71.636 54.587,86.205" style="fill:rgb(255,90,22);fill-rule:nonzero;"/></g></g></g></svg>';c.setAttribute("href",l),c.addClass("kofi-button"),c.appendChild(u.parseFromString(b,"text/xml").documentElement),new r.Setting(t).setName("Usage example code block").setDesc(createFragment(s=>{s.appendText("Use this code block and edit the ");let o=s.createEl("span");o.setText("Title: Value/Total"),o.classList.add("highlight-text"),s.appendText(" as needed."),s.createEl("br"),s.appendText("If you require more than one bar, simply create additional ");let f=s.createEl("span");f.setText("Title: Value/Total"),f.classList.add("highlight-text"),s.appendText(" lines within the code block."),s.createEl("br"),s.appendText("Note: ");let p=s.createEl("span");p.setText("Total"),p.classList.add("highlight-text"),s.appendText(" does not need to be 100."),s.createEl("br"),s.appendText("Visit "),s.createEl("a",{href:"https://cactuzhead.github.io/Advanced-Progress-Bars/",text:"cactuzhead",cls:"custom-link"}),s.appendText(" for more detailed information.")})).addTextArea(s=>{let o=Math.floor(this.plugin.settings.APB_total/100*this.plugin.settings.APB_progressBarPercentage);s.setValue(`\`\`\`apb
${this.plugin.settings.APB_title}: ${o}/${this.plugin.settings.APB_total}
\`\`\``),s.inputEl.style.height="80px",s.inputEl.style.width="200px",s.inputEl.style.resize="none";let f=s.inputEl.parentElement;if(f){let p=t.createEl("button",{text:"Copy to Clipboard",attr:{id:"copypastebutton"}});this.copyButtonListener=M=>{navigator.clipboard.writeText(s.inputEl.value).then(()=>{new r.Notice("Content copied to clipboard!")}).catch(Z=>{new r.Notice("Failed to copy content: "+Z)})},p.addEventListener("click",this.copyButtonListener),p.style.marginTop="10px",p.style.display="block",f.style.display="flex",f.style.flexDirection="column"}else console.error("Unable to find the parent container for the textarea")});let h=new r.Setting(t).setName("Demonstration progress bar").setHeading().settingEl.querySelector(".setting-item-name");h&&h.addClass("header-highlight"),new r.Setting(t).setDesc("Any changes you make to this settings page will be instantly reflected in the demonstration progress bar below.  Use it as a guide when making your decisions. Note that template colors will not be shown in this demo.");let g=t.createEl("div");g.addClass("progressBar-container"),this.plugin.settings.defaultTemplate.borderColor!==this.plugin.settings.APB_pureBlack?g.style.border="1px solid"+this.plugin.settings.defaultTemplate.borderColor:g.style.border="0px",this.plugin.settings.defaultTemplate.backgroundColor!==this.plugin.settings.APB_pureBlack?g.style.background=this.plugin.settings.defaultTemplate.backgroundColor:g.style.background="transparent";let A=this.plugin.settings.APB_boxShadowInsetToggle?" inset ":"";this.plugin.settings.APB_boxShadowToggle?this.plugin.settings.APB_boxShadowTypeToggle?g.style.boxShadow=this.plugin.settings.APB_hOffset+"px "+this.plugin.settings.APB_vOffset+"px "+this.plugin.settings.APB_blur+"px "+this.plugin.settings.APB_colorBoxShadow+A:g.style.boxShadow="0px 0px "+this.plugin.settings.APB_blur+"px "+this.plugin.settings.APB_colorBoxShadow+A:g.style.boxShadow="";let S=t.createEl("div");S.addClass("progressBar-text-container");let C=t.createEl("div");C.addClass("progressBar-background");let w=t.createEl("div");w.addClass("progressBar-title"),this.plugin.settings.defaultTemplate.titleTextColor!==this.plugin.settings.APB_pureBlack&&(w.createEl("span",{text:this.plugin.settings.APB_title}),w.style.color=this.plugin.settings.defaultTemplate.titleTextColor);let T=t.createEl("div");T.addClass("progressBar-percentage"),this.plugin.settings.defaultTemplate.percentageTextColor!==this.plugin.settings.APB_pureBlack&&(T.createEl("span",{text:this.plugin.settings.APB_progressBarPercentage+"%"}),T.style.color=this.plugin.settings.defaultTemplate.percentageTextColor);let W=t.createEl("div");W.addClass("progressBar-value");let P=Math.floor(this.plugin.settings.APB_total/100*this.plugin.settings.APB_progressBarPercentage);this.plugin.settings.defaultTemplate.fractionTextColor!==this.plugin.settings.APB_pureBlack&&(W.createEl("span",{text:"("+P+"/"+this.plugin.settings.APB_total+")"}),W.style.color=this.plugin.settings.defaultTemplate.fractionTextColor);let $=t.createEl("div");$.addClass("progressBar");let F=this.plugin.settings.APB_width,k=parseInt(F.toString(),10),N=Math.min(Math.max(Math.round(this.plugin.settings.APB_progressBarPercentage),0),100);this.plugin.settings.APB_widthToggle?(g.style.width="100%",C.style.width="100%",$.style.width=`${100-N}%`):(g.style.width=`${k}px`,C.style.width=`${String(k-12)}px`,$.style.width=`${100-N}%`),$.style.background=this.plugin.settings.defaultTemplate.barBackgroundColor,g.style.margin="17px",$.style.height=`${this.plugin.settings.APB_height}px`,this.setEndCaps(C,$,this.plugin.settings.APB_endcapToggle,N);let v=document.createElement("div");if(v.className="progressBar-filled",v.style.position="relative",v.style.width=`${N}%`,v.style.height=`${this.plugin.settings.APB_height}px`,C.appendChild(v),this.plugin.settings.APB_endcapToggle&&N>0&&N<100){let s=window.devicePixelRatio||1,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","progressBar-mask"),o.setAttribute("width",`${this.plugin.settings.APB_height/2}`),o.setAttribute("height",`${this.plugin.settings.APB_height}`),o.setAttribute("viewBox",`0 0 ${this.plugin.settings.APB_height/2} ${this.plugin.settings.APB_height}`),o.style.position="absolute",o.style.top="0",o.style.right=`-${1/s}px`,o.style.width=`${(this.plugin.settings.APB_height+.5)/2}px`,o.style.height=`${this.plugin.settings.APB_height}px`,o.innerHTML=`
			<defs>
				<mask id="round-end-mask-demo">
				<rect x="0" y="-1" width="${(this.plugin.settings.APB_height+10.5)/2}" height="${this.plugin.settings.APB_height+3}" fill="white"/>
				<circle cx="0" cy="${this.plugin.settings.APB_height/2}" r="${this.plugin.settings.APB_height/2}" fill="black"/>
				</mask>
			</defs>
			<rect x="0" y="-1" width="${(this.plugin.settings.APB_height+10.5)/2}" height="${this.plugin.settings.APB_height+3}" fill="${this.plugin.settings.defaultTemplate.barBackgroundColor}" mask="url(#round-end-mask-demo)"/>
			`,v.appendChild(o)}C.appendChild($),N!==100&&(C.style.overflow="hidden");let j="defaultTemplate",q=j?this.plugin.settings.templates.find(s=>s.name.toLowerCase()===j.toLowerCase()):null,X=q?q.gradient:(gt=(U=this.plugin.settings.defaultTemplate)==null?void 0:U.gradient)!=null?gt:!0,D=q?q.gradientType:(Tt=(Pt=this.plugin.settings.defaultTemplate)==null?void 0:Pt.gradientType)!=null?Tt:!1,ot=(kt=(At=this.plugin.settings.defaultTemplate)==null?void 0:At.colors)!=null?kt:["#ff0000","#00ff00"],Q=ot.filter(s=>s&&s!=="#000000").slice(0,5),nt=Q.length;if(N<100)if(X)if(Q.length===0&&Q.push(this.plugin.settings.APB_fallbackColor),Q.length===1){let s=Q[0]||this.plugin.settings.APB_fallbackColor;C.style.backgroundColor=s,v.style.backgroundImage=""}else{let s=Q.join(", ");D?(v.style.backgroundImage=`linear-gradient(to right, ${s})`,C.style.backgroundImage=""):(v.style.backgroundImage="",C.style.backgroundImage=`linear-gradient(to right, ${s})`)}else{let s=100/nt,o=Math.min(Math.floor(N/s),nt-1);v.style.backgroundColor=nt>0?Q[o]:this.plugin.settings.APB_fallbackColor,C.style.backgroundImage=""}else{let s=t.createEl("div");s.addClass("progressBar-completed"),this.plugin.settings.defaultTemplate.completedTextColor!==this.plugin.settings.APB_pureBlack&&(s.style.color=this.plugin.settings.defaultTemplate.completedTextColor,this.plugin.settings.APB_progressBarPercentage==100&&(s.textContent="COMPLETED",s.style.position="absolute",s.style.top="50%",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.whiteSpace="nowrap")),v.style.backgroundImage="",v.appendChild(s),this.plugin.settings.defaultTemplate.completedColor!==this.plugin.settings.APB_pureBlack&&(C.style.backgroundColor=N===100?this.plugin.settings.defaultTemplate.completedColor:ot[0])}C.style.backgroundSize="100% 100%",C.style.backgroundRepeat="no-repeat";let dt=t.createEl("div");dt.addClass("marks");var et;if(this.plugin.settings.APB_autoMarksToggle?et=nt:et=this.plugin.settings.APB_manualMarks+1,this.plugin.settings.APB_progressBarPercentage!==100&&(C.appendChild(dt),this.plugin.settings.APB_marksToggle))for(let s=1;s<=et-1;s++){let o=t.createEl("div");o.addClass("mark"),o.style.left=`${s*(100/et)}%`,dt.appendChild(o);let f=window.devicePixelRatio||1,p=this.plugin.settings.APB_marksWidth/f,M=this.hexToRgba(this.plugin.settings.APB_marksColor,.5);o.style.borderLeft=p+"px solid "+M}this.plugin.settings.APB_progressBarChange=!0,this.plugin.saveSettings();let J=t.createEl("p",{text:"This is a demo progress bar."}),Y=t.createEl("div");Y.addClass("custom-container"),Y.appendChild(J),g.appendChild(S),this.plugin.settings.defaultTemplate.titleTextColor!==this.plugin.settings.APB_pureBlack&&S.appendChild(w),this.plugin.settings.defaultTemplate.percentageTextColor!==this.plugin.settings.APB_pureBlack&&S.appendChild(T),this.plugin.settings.defaultTemplate.fractionTextColor!==this.plugin.settings.APB_pureBlack&&S.appendChild(W),Y.appendChild(g),g.appendChild(C);let H=new r.Setting(t).setName("Progress bar").setHeading().settingEl.querySelector(".setting-item-name");H&&H.addClass("header-highlight"),e="Set the default title of a new progress bar. If you change this, the %%Title%% will be automatically changed in the example code block at the top of the settings for easy copy and pasting later on.",i=this.splitTextIntoSegments(e),new r.Setting(t).setName("Default title").setDesc(createFragment(s=>this.renderSegments(i,s))).addText(s=>{let o;s.setPlaceholder("Enter your title").setValue(this.plugin.settings.APB_title||"").onChange(f=>{clearTimeout(o),o=setTimeout(async()=>{this.plugin.settings.APB_title=f,this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()},2e3)})}).addButton(s=>s.setIcon("rotate-ccw").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.APB_title=d.APB_title,this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()}));let st;if(e="Set the default %%Total%% of a new progress bar. If you change this, the %%Total%% will be automatically changed in the example code block above for easy copy and pasting later on.",i=this.splitTextIntoSegments(e),new r.Setting(t).setName("Default total").setDesc(createFragment(s=>this.renderSegments(i,s))).addText(s=>s.setPlaceholder("100").setValue(this.plugin.settings.APB_total!==void 0?String(this.plugin.settings.APB_total):String(d.APB_total)).onChange(o=>{clearTimeout(st),st=setTimeout(async()=>{var p;let f=parseInt(o,10);f>=1&&!isNaN(f)&&f===parseFloat(o)?(this.plugin.settings.APB_total=f,await this.plugin.saveSettings(),this.display()):(s.setValue(String((p=this.plugin.settings.APB_total)!=null?p:d.APB_total)),await this.plugin.saveSettings(),this.display(),new r.Notice("Please enter a value 1 or above."))},1e3)}).inputEl.classList.add("custom-textbox")).addButton(s=>s.setIcon("rotate-ccw").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.APB_total=d.APB_total,this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()})),e="Set the percentage for the demonstration progress bar above. This will also update the %%Value%% parameter in the Example Code at the top of the settings. Once you are satisfied with all other settings, you will likely want to set this back to 0.",i=this.splitTextIntoSegments(e),new r.Setting(t).setName("Progress percentage").setDesc(createFragment(s=>this.renderSegments(i,s))).addSlider(s=>{var o;s.setLimits(0,100,1).setDynamicTooltip().setValue((o=this.plugin.settings.APB_progressBarPercentage)!=null?o:d.APB_progressBarPercentage).onChange(async f=>{this.plugin.settings.APB_progressBarPercentage=f,this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()})}).addButton(s=>s.setIcon("rotate-ccw").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.APB_progressBarPercentage=d.APB_progressBarPercentage,this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()})),this.createToggleSetting(t,"Full width","Toggle this on to set the progress bar to fill the entire width of its container. For a fixed width, toggle this off and use the %%Width%% option that will appear below.","APB_widthToggle"),!this.plugin.settings.APB_widthToggle){let s;new r.Setting(t).setName("Width").setDesc("Set the width of the progress bar container in pixels (minimum 100). Note: If you want it to span the full width, make sure to enable the toggle above.").addText(o=>o.setPlaceholder("200").setValue(this.plugin.settings.APB_width!==void 0?String(this.plugin.settings.APB_width):String(d.APB_width)).onChange(f=>{clearTimeout(s),s=setTimeout(async()=>{var M;let p=parseInt(f,10);p>=100&&!isNaN(p)&&p===parseFloat(f)?(this.plugin.settings.APB_width=p,await this.plugin.saveSettings(),this.display()):(o.setValue(String((M=this.plugin.settings.APB_width)!=null?M:d.APB_width)),await this.plugin.saveSettings(),this.display(),new r.Notice("Please enter a value 100 or above."))},1e3)}).inputEl.classList.add("custom-textbox")).addButton(o=>o.setIcon("rotate-ccw").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.APB_width=d.APB_width,await this.plugin.saveSettings(),this.display()}))}new r.Setting(t).setName("Height").setDesc("Set the height of the progress bar in pixels.  (See demonstration progress bar above)").addSlider(s=>{var o;s.setLimits(1,15,1).setDynamicTooltip().setValue((o=this.plugin.settings.APB_height)!=null?o:d.APB_height).onChange(async f=>{this.plugin.settings.APB_height=f,this.setEndCaps(C,$,this.plugin.settings.APB_endcapToggle,this.plugin.settings.APB_progressBarPercentage),this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()})}).addButton(s=>s.setIcon("rotate-ccw").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.APB_height=d.APB_height,this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()})),this.createToggleSetting(t,"Round end caps","When toggled, the progress bar will have either a round or square end cap.  (See demonstration progress bar above)","APB_endcapToggle");let at=new r.Setting(t).setName("Section marks").setHeading().settingEl.querySelector(".setting-item-name");at&&at.addClass("header-highlight"),this.createToggleSetting(t,"Section marks","When toggled on, the progress bar will have vertical section marks equally spaced along its length.  The number and spacing of these will depend on the settings below. (See demonstration progress bar above)","APB_marksToggle"),this.plugin.settings.APB_marksToggle&&(this.createToggleSetting(t,"Automatically assigned marks","When toggled on, your progress bar will automatically assign equally spaced vertical marks based on how many colors your progress bar template (or default template) uses.<br>Note: if the bar reaches 100% or the bar has only one color or is a gradient, no marks will be displayed automatically.  (toggle off to override this behavior)","APB_autoMarksToggle"),this.plugin.settings.APB_autoMarksToggle||this.createSliderSetting(t,"Number of marks","Manually override the number of evenly spaced marks along the gradient progress bar regardless of the number of colors used.","APB_manualMarks",1,4,1),this.createColorPickerSetting(t,"Section mark color","Select the color of the section %%Marks%%.<br>Note: The color will be set to 50% transparency, allowing the progress bar's color to blend and influence the final appearance.","APB_marksColor",void 0,void 0,d.APB_marksLightColor,d.APB_marksColor),this.createSliderSetting(t,"Section mark width","Set the width of the section mark lines on the progress bar from a range of 1 to 5 pixels.<br>(See demonstration progress bar above)","APB_marksWidth",1,5,1));let ct=new r.Setting(t).setName("Inline edit").setHeading().settingEl.querySelector(".setting-item-name");ct&&ct.addClass("header-highlight"),this.createToggleSetting(t,"Inline edit","When toggled on, you will see a gear icon to the right of the progress bar's text which allows you to edit the value without editing the code block.<br>(See documentation for full details)","APB_inlineEditToggle"),this.plugin.settings.APB_inlineEditToggle&&this.createSliderSetting(t,"Step size","Set the step size for the increment and decrement buttons on the inline edit panel.<br>(See documentation for full details)","APB_inlineEditStepSize",1,100,1);let B=new r.Setting(t).setName("Override error").setHeading().settingEl.querySelector(".setting-item-name");B&&B.addClass("header-highlight"),this.createToggleSetting(t,"Override large value error","When toggled on, you will not get an error when the %%Value%% is greater than the %%Total%%","APB_overageToggle"),this.plugin.settings.APB_overageToggle&&this.createColorPickerSetting(t,"Overage percentage text color","Select the color of the %%Percentage%% text when it is greater than 100%.","APB_overageColor",void 0,void 0,d.APB_overageLightColor,d.APB_overageColor);let G=new r.Setting(t).setName("Progress bar container").setHeading().settingEl.querySelector(".setting-item-name");G&&G.addClass("header-highlight"),this.createToggleSetting(t,"Top margin","When toggled on, the progress bar container will have a larger margin at the top to avoid text being obscured by the %%</>%% in the top right of the code block when you mouse over.","APB_TopMarginToggle");let L=new r.Setting(t).setName("Box shadow").setHeading().settingEl.querySelector(".setting-item-name");L&&L.addClass("header-highlight"),this.createToggleSetting(t,"Box-shadow","When toggled on, a box-shadow will be displayed around the progress bar container.","APB_boxShadowToggle"),this.plugin.settings.APB_boxShadowToggle&&(this.createToggleSetting(t,"Box-shadow type","When toggled on, a box-shadow will be displayed to the lower right of the progress bar container.  When toggled off, a glow shadow will be shown around the progress bar container.","APB_boxShadowTypeToggle"),this.plugin.settings.APB_boxShadowTypeToggle&&(this.createSliderSetting(t,"H-offset","Set the %%horizontal%% offset of the box-shadow from a range of 1 to 5 pixels.  (See demonstration progress bar above)","APB_hOffset",0,5,1),this.createSliderSetting(t,"V-offset","Set the %%vertical%% offset of the box-shadow from a range of 1 to 5 pixels.  (See demonstration progress bar above)","APB_vOffset",0,5,1)),this.createSliderSetting(t,"Blur","Set the %%blur%% of the %%box-shadow%% from a range of 0 to 5 pixels.  %%(See demonstration progress bar above)%%","APB_blur",0,5,1),this.createToggleSetting(t,"Inset","When toggled on, it will be displayed as an inner shadow.  When toggled off, an outer shadow will be shown instead.","APB_boxShadowInsetToggle"),this.createColorPickerSetting(t,"Box-shadow color","Select the color of the container's box-shadow.","APB_colorBoxShadow",void 0,void 0,d.APB_colorLightBoxShadow,d.APB_colorBoxShadow));let K=new r.Setting(t).setName("Tasks").setHeading().settingEl.querySelector(".setting-item-name");K&&K.addClass("header-highlight"),this.createToggleSetting(t,"Enable task linking","When %%toggled on%%, you will be able to automatically update progress bars by using matching tags in the progress bar's title and tasks.  See documentation for full details.","APB_allowTasksToggle"),this.plugin.settings.APB_allowTasksToggle&&(this.createToggleSetting(t,"Auto tasks","When %%toggled on%%, tasks are automatically updated when it detects editing on the current page.  It is %%highly recommended%% that this is turned %%off%% and you use manually triggered updates instead using page switching or hotkey.  See documentation for full details.","APB_autoTasksToggle"),this.createToggleSetting(t,"Enable sub-task linking","When %%toggled on%%, you will be able to automatically see your subtask status under the progerss bar.<br>See documentation for full details.","APB_allowSubTasksToggle"));let tt=new r.Setting(t).setName("Templates").setHeading().settingEl.querySelector(".setting-item-name");tt&&tt.addClass("header-highlight"),e="Create a template with custom gradient or stepped colors.<br>Note that %%color pickers%% with a value of %%#000000%% (%%pure black%%) will be ignored.<br>The %%default template%% is applied to all progress bars that do %%not%% have a custom template assigned.<br>(See documentation for full details)",i=this.splitTextIntoSegments(e),new r.Setting(t).setName("Add new template").setDesc(createFragment(s=>this.renderSegments(i,s))).addButton(s=>s.setButtonText("Add template").setTooltip("Create a new template").onClick(async()=>{let o=this.plugin.settings.templates.length;this.plugin.settings.templates.push({name:"New Template "+(o+1),gradient:!1,gradientType:!1,colors:["#000000","#000000","#000000","#000000","#000000"],isColorPanelVisible:!1,borderColor:"#000000",backgroundColor:"#000000",titleTextColor:"#000000",percentageTextColor:"#000000",fractionTextColor:"#000000",completedTextColor:"#000000",completedColor:"#000000",barBackgroundColor:"#000000",colorSubTaskCompletedText:"#000000",colorSubTaskText:"#000000"}),await this.plugin.saveSettings(),this.display()}));let ht=t.createDiv({cls:"settings-row-container"}).createDiv({cls:"settings-row-headers"});["Template Name","|","Settings","|","Gradient Toggle","|","Gradient Type Toggle","|","Color 1 - 5","|","3 Color Presets"].forEach((s,o)=>{ht.createEl("span",{text:s,cls:["settings-row-header",s==="Gradient Toggle"||s==="Gradient Type Toggle"?"gradient-header":""]})});let y=new r.Setting(t).setClass("default-setting-row");y.addExtraButton(s=>{s.setIcon("lock").setTooltip("Default template (non-deletable)").extraSettingsEl.createEl("span",{text:"Default",cls:"setting-item-name",attr:{style:"flex: 1; padding: 4px 8px; color: #888888;"}})}),y.addButton(s=>{s.setIcon("gear").setTooltip("Edit Extended Colors").setClass(this.plugin.settings.defaultTemplate.isColorPanelVisible?"active-default-gear":"inactive-gear").onClick(async()=>{this.collapseOtherPanels("default"),this.plugin.settings.defaultTemplate.isColorPanelVisible=!this.plugin.settings.defaultTemplate.isColorPanelVisible,await this.plugin.saveSettings(),this.display(),this.defaultContainerColorPickerPanel()})}),this.defaultColorPickerContainer=t.createDiv({cls:"default-container-color-picker-panel"}),this.defaultContainerColorPickerPanel(),y.addToggle(s=>{s.setValue(this.plugin.settings.defaultTemplate.gradient).setTooltip("Enable gradient").onChange(async o=>{this.plugin.settings.defaultTemplate.gradient=o,await this.plugin.saveSettings(),this.display()})}),y.addToggle(s=>{s.setValue(this.plugin.settings.defaultTemplate.gradientType).setTooltip("Gradient type: (off) Linear / (on) Color-mix").onChange(async o=>{this.plugin.settings.defaultTemplate.gradientType=o,await this.plugin.saveSettings(),this.display()})});for(let s=0;s<5;s++)y.addColorPicker(o=>{o.setValue(this.plugin.settings.defaultTemplate.colors[s]||this.plugin.settings.APB_pureBlack).onChange(async f=>{this.plugin.settings.defaultTemplate.colors[s]=f,await this.plugin.saveSettings(),this.display()})});y.addButton(s=>{s.setIcon("sun").setTooltip("Reset to light default").onClick(async()=>{this.plugin.settings.defaultTemplate.colors=[...this.plugin.settings.defaultLightColors],await this.plugin.saveSettings(),this.display()})}),y.addButton(s=>{s.setIcon("moon").setTooltip("Reset to dark default").onClick(async()=>{this.plugin.settings.defaultTemplate.colors=[...this.plugin.settings.defaultDarkColors],await this.plugin.saveSettings(),this.display()})}),y.addButton(s=>{s.setIcon("rainbow").setTooltip("Reset to rainbow default").onClick(async()=>{this.plugin.settings.defaultTemplate.colors=[...this.plugin.settings.defaultRainbowColors],await this.plugin.saveSettings(),this.display()})}),y.settingEl.createDiv({cls:"spacer-button"}),this.plugin.settings.templates.forEach((s,o)=>{let f=new r.Setting(t).setClass("template-setting-row").setName(`${o+1}`);f.addText(p=>{p.setPlaceholder("Template name").setValue(s.name).onChange(async M=>{clearTimeout(st),st=setTimeout(async()=>{let Z=M.trim()||"Unnamed",_t=Z;if(this.plugin.settings.templates.filter((it,ft)=>ft!==o).some(it=>it.name.toLowerCase()===Z.toLowerCase())||Z.toLowerCase()===this.plugin.settings.defaultTemplate.name.toLowerCase()){let it=2;for(;this.plugin.settings.templates.some((ft,xt)=>xt!==o&&ft.name.toLowerCase()===`${Z} ${it}`.toLowerCase())||`${Z} ${it}`.toLowerCase()===this.plugin.settings.defaultTemplate.name.toLowerCase();)it++;_t=`${Z} ${it}`}this.plugin.settings.templates[o].name=_t,await this.plugin.saveSettings(),this.display()},1e3)}),p.inputEl.style.flex="1"}),f.addButton(p=>p.setIcon("gear").setTooltip("Edit Extended Colors").setClass(this.plugin.settings.templates[o].isColorPanelVisible?"active-template-gear":"inactive-gear").onClick(async()=>{this.collapseOtherPanels(o),this.plugin.settings.templates[o].isColorPanelVisible=!this.plugin.settings.templates[o].isColorPanelVisible,await this.plugin.saveSettings(),this.display(),this.containerColorPickerPanel(o)})),this.colorPickerContainers[o]=t.createDiv({cls:"container-color-picker-panel"}),this.containerColorPickerPanel(o),f.addToggle(p=>{p.setValue(s.gradient).setTooltip("Enable gradient").onChange(async M=>{this.plugin.settings.templates[o].gradient=M,await this.plugin.saveSettings(),this.display()})}),f.addToggle(p=>{p.setValue(s.gradientType).setTooltip("Gradient type: (off) Linear / (on) Color-mix").onChange(async M=>{this.plugin.settings.templates[o].gradientType=M,await this.plugin.saveSettings(),this.display()})});for(let p=0;p<5;p++)f.addColorPicker(M=>{M.setValue(s.colors[p]||this.plugin.settings.APB_pureBlack).onChange(async Z=>{this.plugin.settings.templates[o].colors[p]=Z,await this.plugin.saveSettings(),this.display()})});f.addButton(p=>{p.setIcon("sun").setTooltip("Reset to light default").onClick(async()=>{this.plugin.settings.templates[o].colors=[...this.plugin.settings.defaultLightColors],await this.plugin.saveSettings(),this.display()})}),f.addButton(p=>{p.setIcon("moon").setTooltip("Reset to dark default").onClick(async()=>{this.plugin.settings.templates[o].colors=[...this.plugin.settings.defaultDarkColors],await this.plugin.saveSettings(),this.display()})}),f.addButton(p=>{p.setIcon("rainbow").setTooltip("Reset to rainbow default").onClick(async()=>{this.plugin.settings.templates[o].colors=[...this.plugin.settings.defaultRainbowColors],await this.plugin.saveSettings(),this.display()})}),f.addButton(p=>{p.setIcon("arrow-up").setTooltip("Move up").setClass("subtle-button").setDisabled(o===0).onClick(async()=>{if(o>0){let M=this.plugin.settings.templates[o];this.plugin.settings.templates[o]=this.plugin.settings.templates[o-1],this.plugin.settings.templates[o-1]=M,await this.plugin.saveSettings(),this.display()}})}),f.addButton(p=>{p.setIcon("arrow-down").setTooltip("Move down").setClass("subtle-button").setDisabled(o===this.plugin.settings.templates.length-1).onClick(async()=>{if(o<this.plugin.settings.templates.length-1){let M=this.plugin.settings.templates[o];this.plugin.settings.templates[o]=this.plugin.settings.templates[o+1],this.plugin.settings.templates[o+1]=M,await this.plugin.saveSettings(),this.display()}})}),f.addButton(p=>{p.setIcon("trash").setTooltip("Delete template").setClass("subtle-button").onClick(async()=>{this.plugin.settings.templates.splice(o,1),await this.plugin.saveSettings(),this.display()})})})}defaultContainerColorPickerPanel(){let t=this.defaultColorPickerContainer;if(!t)return;t.empty();let e=this.plugin.settings.defaultTemplate;if(t.style.display=e.isColorPanelVisible?"block":"none",e.isColorPanelVisible){this.createColorPickerSetting(t,"Default container border color","Choose the %%border%% color of the default progress bar container.","default",void 0,"borderColor",d.APB_colorLightBorder,d.APB_colorBorder),this.createColorPickerSetting(t,"Default container background color","Choose the %%background%% color of the default progress bar container.","default",void 0,"backgroundColor",d.APB_colorLightBackground,d.APB_colorBackground),this.createColorPickerSetting(t,"Default title text color","Choose the %%Title%% text color for the default template.","default",void 0,"titleTextColor",d.APB_titleLightColor,d.APB_titleColor),this.createColorPickerSetting(t,"Default percentage text color","Choose the %%Percentage%% text color for the default template.","default",void 0,"percentageTextColor",d.APB_percentageLightColor,d.APB_percentageColor),this.createColorPickerSetting(t,"Default fraction text color","Choose the %%Fraction%% text color for the default template.","default",void 0,"fractionTextColor",d.APB_fractionLightColor,d.APB_fractionColor),this.createColorPickerSetting(t,"Default completed text color","Choose the %%Completed text%% color for the default template.","default",void 0,"completedTextColor",d.APB_completedLightColor,d.APB_completedColor),this.createColorPickerSetting(t,"Default bar background color","Choose the %%Bar background%% color for the default template.  NOTE: this is the only color that can be set to pure black #000000 as it can not be transparent for the progress bar to work corectly","default",void 0,"barBackgroundColor",d.APB_colorLightBarBackground,d.APB_colorBarBackground),this.createColorPickerSetting(t,"Default completed bar background color","Choose the %%Completed bar%% background color for the default template.","default",void 0,"completedColor",d.APB_colorLightBarCompleted,d.APB_colorBarCompleted),this.createColorPickerSetting(t,"Default Sub task text color","Choose the %%text%% color for the sub task shown under your progress bar.","default",void 0,"colorSubTaskText",d.APB_colorLightSubTaskText,d.APB_colorSubTaskText),this.createColorPickerSetting(t,"Default Sub task completed text color","Choose the %%completed text%% color for the sub task shown under your progress bar.","default",void 0,"colorSubTaskCompletedText",d.APB_colorLightSubTaskCompletedText,d.APB_colorSubTaskCompletedText);let i="All the above settings within the green border have been removed from standard settings and are now integrated into this default template.  Use this button to copy %%ALL pre v1.1.4%% values into this default template container settings.",a=this.splitTextIntoSegments(i);new r.Setting(t).setName("Transfer all your default settings to this default template").setDesc(createFragment(l=>this.renderSegments(a,l))).addButton(l=>l.setIcon("copy").setTooltip("Transfer default values").onClick(async()=>{var n,c,u,b,m,h,g,A,S,C;this.plugin.settings.defaultTemplate.borderColor=this.plugin.settings.APB_borderToggle?(n=this.plugin.settings.APB_colorBorder)!=null?n:this.plugin.settings.APB_pureBlack:this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.backgroundColor=this.plugin.settings.APB_backgroundToggle?(c=this.plugin.settings.APB_colorBackground)!=null?c:this.plugin.settings.APB_pureBlack:this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.titleTextColor=this.plugin.settings.APB_titleToggle?(u=this.plugin.settings.APB_titleColor)!=null?u:this.plugin.settings.APB_pureBlack:this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.percentageTextColor=this.plugin.settings.APB_percentageToggle?(b=this.plugin.settings.APB_percentageColor)!=null?b:this.plugin.settings.APB_pureBlack:this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.fractionTextColor=this.plugin.settings.APB_fractionToggle?(m=this.plugin.settings.APB_fractionColor)!=null?m:this.plugin.settings.APB_pureBlack:this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.completedTextColor=this.plugin.settings.APB_completedToggle?(h=this.plugin.settings.APB_completedColor)!=null?h:this.plugin.settings.APB_pureBlack:this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.completedColor=(g=this.plugin.settings.APB_colorBarCompleted)!=null?g:this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.barBackgroundColor=(A=this.plugin.settings.APB_colorBarBackground)!=null?A:this.plugin.settings.APB_pureBlack,this.plugin.settings.APB_allowTasksToggle&&this.plugin.settings.APB_allowSubTasksToggle?(this.plugin.settings.defaultTemplate.colorSubTaskText=(S=this.plugin.settings.APB_colorSubTaskText)!=null?S:this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.colorSubTaskCompletedText=(C=this.plugin.settings.APB_colorSubTaskCompletedText)!=null?C:this.plugin.settings.APB_pureBlack):(this.plugin.settings.defaultTemplate.colorSubTaskText=this.plugin.settings.APB_pureBlack,this.plugin.settings.defaultTemplate.colorSubTaskCompletedText=this.plugin.settings.APB_pureBlack),await this.plugin.saveSettings(),this.display()}))}}containerColorPickerPanel(t){var a,l,n,c,u,b,m,h,g,A;let e=this.colorPickerContainers[t];if(!e)return;e.empty();let i=this.plugin.settings.templates[t];e.style.display=i.isColorPanelVisible?"block":"none",i.isColorPanelVisible&&(this.createColorPickerSetting(e,"Container border color","Choose the %%border%% color of the %%progress bar%% container.","templates",t,"borderColor",(a=this.plugin.settings.defaultTemplate)==null?void 0:a.borderColor,d.APB_pureBlack),this.createColorPickerSetting(e,"Container background color","Choose the %%background%% color of the %%progress bar%% container.","templates",t,"backgroundColor",(l=this.plugin.settings.defaultTemplate)==null?void 0:l.backgroundColor,d.APB_pureBlack),this.createColorPickerSetting(e,"Container title text color","Choose the %%Title%% text color for this template.","templates",t,"titleTextColor",(n=this.plugin.settings.defaultTemplate)==null?void 0:n.titleTextColor,d.APB_pureBlack),this.createColorPickerSetting(e,"Container percentage text color","Choose the %%Percentage%% text color for this template.","templates",t,"percentageTextColor",(c=this.plugin.settings.defaultTemplate)==null?void 0:c.percentageTextColor,d.APB_pureBlack),this.createColorPickerSetting(e,"Container fraction text color","Choose the %%Fraction%% text color for this template.","templates",t,"fractionTextColor",(u=this.plugin.settings.defaultTemplate)==null?void 0:u.fractionTextColor,d.APB_pureBlack),this.createColorPickerSetting(e,"Container completed text color","Choose the %%Completed%% text color for this template.","templates",t,"completedTextColor",(b=this.plugin.settings.defaultTemplate)==null?void 0:b.completedTextColor,d.APB_pureBlack),this.createColorPickerSetting(e,"Bar background color","Choose the %%Background Bar%% color for this template.  NOTE: this is the only color that can be set to pure black #000000 as it can not be transparent for the progress bar to work corectly","templates",t,"barBackgroundColor",(m=this.plugin.settings.defaultTemplate)==null?void 0:m.barBackgroundColor,d.APB_pureBlack),this.createColorPickerSetting(e,"Completed bar color","Choose the %%Completed%% bar color for this template.","templates",t,"completedColor",(h=this.plugin.settings.defaultTemplate)==null?void 0:h.completedColor,d.APB_pureBlack),this.createColorPickerSetting(e,"Sub task color","Choose the %%text%% color for the sub task shown under your progress bar.","templates",t,"colorSubTaskText",(g=this.plugin.settings.defaultTemplate)==null?void 0:g.colorSubTaskText,d.APB_pureBlack),this.createColorPickerSetting(e,"Sub task completed color","Choose the %%completed text%% color for the sub task shown under your progress bar.","templates",t,"colorSubTaskCompletedText",(A=this.plugin.settings.defaultTemplate)==null?void 0:A.colorSubTaskCompletedText,d.APB_pureBlack))}setEndCaps(t,e,i,a){t&&e?i?(t.style.borderRadius="7px",a==0?e.style.borderRadius="7px":e.style.borderRadius="0 7px 7px 0"):(t.style.borderRadius="0px",e.style.borderRadius="0px"):console.error("Elements are not defined")}hexToRgba(t,e=1){t=t.replace("#",""),t.length===3&&(t=t.split("").map(n=>n+n).join(""));let i=parseInt(t.slice(0,2),16),a=parseInt(t.slice(2,4),16),l=parseInt(t.slice(4,6),16);return`rgba(${i}, ${a}, ${l}, ${e})`}addColorResetButtonsForSettings(t,e,i,a,l){let n=l!==void 0?"paintbrush":"sun",c=l!==void 0?"rotate-ccw":"moon",u=l!==void 0?"Reset to default template color":"Reset to light default",b=l!==void 0?"Reset to pure black":"Reset to dark default";t.addButton(m=>{this.addColorResetButton(m,n,u,e,i,this.colorPickers[e])}),t.addButton(m=>{this.addColorResetButton(m,c,b,e,a,this.colorPickers[e])})}addColorResetButton(t,e,i,a,l,n){t.setIcon(e).setTooltip(i).onClick(async()=>{this.setSettingValue(a,l),n&&n.setValue(l),await this.plugin.saveSettings(),this.display()})}createColorPickerSetting(t,e,i,a,l,n,c,u){let b=this.splitTextIntoSegments(i),m=new r.Setting(t).setName(e).setDesc(createFragment(h=>this.renderSegments(b,h))).addColorPicker(h=>{this.colorPickers[a]=h;let g=l!==void 0&&n?this.plugin.settings.templates[l][n]||this.plugin.settings.APB_pureBlack:n?this.plugin.settings.defaultTemplate[n]||this.plugin.settings.APB_pureBlack:this.plugin.settings[a]||this.plugin.settings.APB_pureBlack;h.setValue(g).onChange(async A=>{l!==void 0&&n?this.plugin.settings.templates[l][n]=A:n?this.plugin.settings.defaultTemplate[n]=A:this.plugin.settings[a]=A,await this.plugin.saveSettings(),this.display()})});this.addColorResetButtonsForSettings(m,a,c||"#ffffff",u||"#000000",l)}getSettingValue(t){let e=t.split(".");if(e[0]==="templates"&&e.length>=3){let i=parseInt(e[1]);if(i>=0&&i<this.plugin.settings.templates.length){if(e[2]==="colors"&&e[3]){let a=parseInt(e[3]);return this.plugin.settings.templates[i].colors[a]||"#ffffff"}return this.plugin.settings.templates[i][e[2]]||"#ffffff"}}return"#ffffff"}setSettingValue(t,e){let i=t.split(".");if(i[0]==="templates"&&i.length>=3){let a=parseInt(i[1]);if(a>=0&&a<this.plugin.settings.templates.length)if(i[2]==="colors"&&i[3]){let l=parseInt(i[3]);this.plugin.settings.templates[a].colors[l]=e}else this.plugin.settings.templates[a][i[2]]=e}}collapseOtherPanels(t){this.plugin.settings.templates.forEach((e,i)=>{i!==t&&(e.isColorPanelVisible=!1)}),t!=="default"&&(this.plugin.settings.defaultTemplate.isColorPanelVisible=!1)}createToggleSetting(t,e,i,a){let l=this.splitTextIntoSegments(i),n=new r.Setting(t).setName(e).setDesc(createFragment(c=>this.renderSegments(l,c))).addToggle(c=>c.setValue(this.plugin.settings[a]).onChange(async u=>{this.plugin.settings[a]=u,await this.plugin.saveSettings(),this.display()})).addButton(c=>c.setIcon("rotate-ccw").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings[a]=d[a],await this.plugin.saveSettings(),this.display()}))}createSliderSetting(t,e,i,a,l,n,c){let u=this.splitTextIntoSegments(i),b=new r.Setting(t).setName(e).setDesc(createFragment(m=>this.renderSegments(u,m))).addSlider(m=>{var h;m.setLimits(l,n,c).setDynamicTooltip().setValue((h=this.plugin.settings[a])!=null?h:d[a]).onChange(async g=>{this.plugin.settings[a]=g,this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()})}).addButton(m=>m.setIcon("rotate-ccw").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings[a]=d[a],this.plugin.settings.APB_progressBarChange=!0,await this.plugin.saveSettings(),this.display()}))}splitTextIntoSegments(t){let e=/%%([^%]*)%%|<br>/g,i=[],a=0,l;for(;(l=e.exec(t))!==null;){let n=t.slice(a,l.index);if(n&&i.push({text:n,isHighlighted:!1}),l[0]==="<br>")i.push({text:"",isHighlighted:!1,isNewLine:!0});else{let c=l[1];i.push({text:c,isHighlighted:!0})}a=l.index+l[0].length}return a<t.length&&i.push({text:t.slice(a),isHighlighted:!1}),i.length===0&&i.push({text:t,isHighlighted:!1}),i}renderSegments(t,e){t.forEach(i=>{if(i.isNewLine)e.appendChild(document.createElement("br"));else{let a=e.createSpan();a.textContent=i.text,i.isHighlighted&&a.addClass("highlight-text")}})}};function wt(V,E=1){let e=V.replace(/rgb(a)?\(|\)/g,"").trim().split(/,\s*|\s+/).map(Number);if(e.length<3||e.length>4||e.some(isNaN)||e.slice(0,3).some(h=>h<0||h>255))throw new Error("Invalid RGB/A format. Expected: rgb(r, g, b) or rgba(r, g, b, a) with r,g,b 0-255, a 0-1");let[i,a,l]=e,n=i/255,c=a/255,u=l/255,m=.2126*n+.7152*c+.0722*u>.5?"#000000":"#FFFFFF";if(E<1){let h=m.replace("#",""),g=parseInt(h.substring(0,2),16),A=parseInt(h.substring(2,4),16),S=parseInt(h.substring(4,6),16);return`rgba(${g}, ${A}, ${S}, ${E})`}return m}function yt(V,E){let t;return(...e)=>{clearTimeout(t),t=setTimeout(()=>V.apply(this,e),E)}}function ut(V,E){let t=document.createElement("div");t.addClass("error-container");let e=document.createElement("div");e.addClass("error-text-container"),e.createEl("span",{text:E}),t.appendChild(e),V.appendChild(t)}

/* nosourcemap */